{% extends 'base.html' %}
{% block title %}{{ _('–ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–∞') }}{% endblock %}
{% block content %}
<div class="container mt-4">

  <!-- –ö–Ω–æ–ø–∫–∞ –ù–∞–∑–∞–¥ (–¢–û–õ–¨–ö–û –Ω–∞–¥ —Ç–æ–≤–∞—Ä–æ–º) -->
  <a href="{{ url_for('index') }}" class="btn btn-outline-secondary btn-sm mb-3">
    ‚Üê {{ _('–ù–∞–∑–∞–¥') }}
  </a>

  <h2 class="mb-4">
    <span style="font-size: 1.4em;">ü™®</span> {{ product.name }}
  </h2>

  <div class="row">

    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞ -->
    <div class="col-md-4 mb-4">

      {# –ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ? –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—É—Å–µ–ª—å #}
{% if images and images|length > 0 %}
  {% set carousel_id = 'productCarousel_' ~ product.id %}
  <div id="{{ carousel_id }}" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
      {% for img in images %}
        <div class="carousel-item {% if loop.first %}active{% endif %}">
          <img src="{{ img.url }}" class="d-block w-100 rounded border shadow-sm" alt="{{ product.name }}">
        </div>
      {% endfor %}
    </div>

    {% if images|length > 1 %}
      <button class="carousel-control-prev" type="button"
              data-bs-target="#{{ carousel_id }}" data-bs-slide="prev"
              aria-label="{{ _('–ü—Ä–µ–¥—ã–¥—É—â–µ–µ —Ñ–æ—Ç–æ') }}">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">{{ _('–ù–∞–∑–∞–¥') }}</span>
      </button>
      <button class="carousel-control-next" type="button"
              data-bs-target="#{{ carousel_id }}" data-bs-slide="next"
              aria-label="{{ _('–°–ª–µ–¥—É—é—â–µ–µ —Ñ–æ—Ç–æ') }}">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">{{ _('–í–ø–µ—Ä—ë–¥') }}</span>
      </button>
    {% endif %}
  </div>

<!-- üî¢ –°—á—ë—Ç—á–∏–∫ —Ñ–æ—Ç–æ -->
<div class="text-center mt-2">
  <span id="photoCounter_{{ product.id }}" class="small text-muted">1 / {{ images|length }}</span>
</div>

  <script>
  document.addEventListener("DOMContentLoaded", function() {
    var counter = document.getElementById("photoCounter_{{ product.id }}");
    var carousel = document.getElementById("{{ carousel_id }}");

    if (carousel && counter) {
      carousel.addEventListener("slid.bs.carousel", function (event) {
        var total = carousel.querySelectorAll(".carousel-item").length;
        var index = event.to + 1;
        counter.textContent = index + " / " + total;
      });
    }
  });
  </script>

{% elif product.image_url %}
  <img src="{{ product.image_url }}" class="img-fluid rounded border shadow-sm" alt="{{ product.name }}">
{% endif %}

    </div>

    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –¥–µ—Ç–∞–ª–∏ -->
    <div class="col-md-8">
      <table class="table table-bordered">
        <tbody>
          <tr>
            <th>{{ _('–û–ø–∏—Å–∞–Ω–∏–µ') }}</th>
            <td>{{ product.description or '‚Äî' }}</td>
          </tr>
          <tr>
            <th>{{ _('–ö–∞—Ç–µ–≥–æ—Ä–∏—è') }}</th>
            <td>{{ category.name if category else '‚Äî' }}</td>
          </tr>
          <tr>
            <th>{{ _('–ö–æ–ª-–≤–æ') }}</th>
            <td>{{ product.quantity }} {{ product.unit }}</td>
          </tr>
          <tr>
            <th>{{ _('–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è') }}</th>
            <td>{{ product.created_at_fmt }}</td>
          </tr>
        </tbody>
      </table>

      {% if g.user.role == 'editor' %}
      <div class="mt-4 d-flex gap-2">
        <a href="{{ url_for('edit', product_id=product.id) }}" class="btn btn-warning">
          ‚úèÔ∏è {{ _('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å') }}
        </a>
        <form action="{{ url_for('delete', product_id=product.id) }}" method="POST"
              onsubmit="return confirm('{{ _('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?') }}');">
          <button type="submit" class="btn btn-danger">üóëÔ∏è {{ _('–£–¥–∞–ª–∏—Ç—å') }}</button>
        </form>
      </div>
      {% endif %}
    </div>

  </div>
</div>
{% endblock %}