{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>üì¶ {{ _('–£—á—ë—Ç —Ç–æ–≤–∞—Ä–æ–≤') }}</h2>
  {% if g.user.role == 'editor' %}
  <div>
    <a href="{{ url_for('create') }}" class="btn btn-success">‚ûï {{ _('–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä') }}</a>
    <a href="{{ url_for('add_category') }}" class="btn btn-success">üìÅ {{ _('–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é') }}</a>
    <a href="{{ url_for('export_excel') }}" class="btn btn-outline-secondary">{{ _('–°–∫–∞—á–∞—Ç—å Excel') }}</a>
  </div>
  {% endif %}
</div>

<!-- –§–∏–ª—å—Ç—Ä –ø–æ–∏—Å–∫–∞ -->
<form method="get" class="row g-2 mb-4">
  <div class="col-md-3">
    <input type="text" name="search" value="{{ request.args.get('search', '') }}" class="form-control" placeholder="{{ _('–ù–∞–∑–≤–∞–Ω–∏–µ...') }}">
  </div>
  <div class="col-md-2">
    <select name="category_id" class="form-select">
      <option value="">{{ _('–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏') }}</option>
      {% for cat in categories %}
        <option value="{{ cat.id }}" {% if request.args.get('category_id', '')|int == cat.id %}selected{% endif %}>
          {# –í–´–í–û–î –Ω–∞ –Ω—É–∂–Ω–æ–º —è–∑—ã–∫–µ! #}
          {% if current_lang == 'fi' and cat.name_fi %}
            {{ cat.name_fi }}
          {% elif current_lang == 'en' and cat.name_en %}
            {{ cat.name_en }}
          {% else %}
            {{ cat.name }}
          {% endif %}
        </option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <input type="text" name="size" value="{{ request.args.get('size', '') }}" class="form-control" placeholder="{{ _('–†–∞–∑–º–µ—Ä') }}">
  </div>
  <div class="col-md-2">
    <input type="number" step="0.01" name="price" value="{{ request.args.get('price', '') }}" class="form-control" placeholder="{{ _('–¶–µ–Ω–∞ ‚â§') }}">
  </div>
  <div class="col-md-2">
    <input type="number" step="0.01" name="quantity" value="{{ request.args.get('quantity', '') }}" class="form-control" placeholder="{{ _('–ö–æ–ª-–≤–æ ‚â•') }}">
  </div>
  <div class="col-md-1">
    <button type="submit" class="btn btn-outline-primary w-100">{{ _('–ü–æ–∏—Å–∫') }}</button>
  </div>
  <div class="col-md-12 mt-2">
    <a href="{{ url_for('index') }}" class="btn btn-link">{{ _('–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä') }}</a>
  </div>
</form>

<table class="table table-bordered align-middle table-hover mb-5">
  <thead class="table-dark">
    <tr>
      <th>{{ _('–ù–∞–∑–≤–∞–Ω–∏–µ') }}</th>
      <th>{{ _('–ö–∞—Ç–µ–≥–æ—Ä–∏—è') }}</th>
      <th>{{ _('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ') }}</th>
      <th>{{ _('–†–∞–∑–º–µ—Ä') }}</th>
      <th>{{ _('–¶–µ–Ω–∞, ‚Ç¨') }}</th>
      <th>{{ _('–î–µ–π—Å—Ç–≤–∏—è') }}</th>
    </tr>
  </thead>
  <tbody>
    {% for product in products %}
    <tr>
      <td>
        <a href="{{ url_for('view', product_id=product.id) }}" class="text-decoration-none d-flex align-items-center gap-2">
          {% if product.image_url %}
            <img src="{{ product.image_url }}" alt="{{ product.name }}" style="height:36px; width:auto; border-radius:6px; object-fit:cover; margin-right: 7px;">
          {% endif %}
          {{ product.name }}
        </a>
      </td>
      <td>
        {# –í–´–í–û–î –Ω–∞ –Ω—É–∂–Ω–æ–º —è–∑—ã–∫–µ! #}
        {% if current_lang == 'fi' and product.category_name_fi %}
          {{ product.category_name_fi }}
        {% elif current_lang == 'en' and product.category_name_en %}
          {{ product.category_name_en }}
        {% else %}
          {{ product.category_name }}
        {% endif %}
      </td>
      <td>{{ product.quantity }} {{ product.unit }}</td>
      <td>{{ product.size }}</td>
      <td>{% if product.price is not none %}{{ '%.2f'|format(product.price) }}{% endif %}</td>
      <td>
        {% if g.user.role == 'editor' %}
        <a href="{{ url_for('edit', product_id=product.id) }}" class="btn btn-warning btn-sm">{{ _('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å') }}</a>
        <form action="{{ url_for('delete', product_id=product.id) }}" method="post" style="display:inline;">
          <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('{{ _('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?') }}')">{{ _('–£–¥–∞–ª–∏—Ç—å') }}</button>
        </form>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
    {% if not products %}
      <tr><td colspan="6" class="text-center">{{ _('–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ') }}</td></tr>
    {% endif %}
  </tbody>
</table>

<!-- –§–∏—Ä–º–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ -->
<div class="main-card mt-4 p-4" style="max-width: 600px; margin-left: auto; margin-right: auto;">
  <h5>üìä {{ _('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:') }}</h5>
  <ul class="list-group mb-4">
    <li class="list-group-item">{{ _('–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤:') }} <strong>{{ total_products }}</strong></li>
    <li class="list-group-item">{{ _('–í—Å–µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:') }} <strong>{{ total_categories }}</strong></li>
  </ul>

  <h5>üÜï {{ _('–ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã:') }}</h5>
  <ul class="list-group">
    {% for product in recent_products %}
    <li class="list-group-item">
      <a href="{{ url_for('view', product_id=product.id) }}" class="text-decoration-none">
        {{ product.name }} ({{ product.quantity }} {{ product.unit }})
      </a>
      ‚Äî {{ product.created_at[:16].replace('T', ' ') }}
    </li>
    {% endfor %}
  </ul>
</div>
{% endblock %}