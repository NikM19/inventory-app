{% extends 'base.html' %}
{% from 'macros.html' import back_button %}
{% block content %}

<div class="container main-card">
  <div class="d-flex align-items-center justify-content-between mb-3">
    {{ back_button(url_for('index')) }}
    <h3 class="m-0">{{ _('Журнал действий') }}</h3>
  </div>

  <div class="table-rounded-container">
    <table class="table align-middle table-hover mb-5 table-logs">
      <thead class="table-dark">
        <tr>
          <th>{{ _('Дата и время') }}</th>
          <th>{{ _('Пользователь') }}</th>
          <th>{{ _('Действие') }}</th>
          <th>{{ _('Объект') }}</th>
          <th>{{ _('Детали') }}</th>
        </tr>
      </thead>
      <tbody>
        {% if logs and logs|length %}
          {% for log in logs %}
          <tr>
            <td data-label="{{ _('Дата и время') }}">
              {{ (log.timestamp[:19].replace('T',' ') if log.timestamp is string else log.timestamp)|default('—') }}
            </td>
            <td data-label="{{ _('Пользователь') }}">{{ log.username|default('—') }}</td>
            <td data-label="{{ _('Действие') }}">{{ log.action|default('—') }}</td>
            <td data-label="{{ _('Объект') }}">
              {{ log.object_type|default('—') }}{% if log.object_id %} #{{ log.object_id }}{% endif %}
            </td>

            {# ---- Изменено: показываем кнопку "Отменить удаление", если можно ---- #}
<td data-label="{{ _('Детали') }}">
  {{ log.details|default('—') }}

  {% if log.can_undo %}
    {% if log.id %}
<form method="post"
      action="{{ url_for('undo_log', log_id=log.id) }}"
      class="d-inline ms-2"
      data-confirm-title="{{ _('Восстановить товар') }}"
      data-confirm="{{ _('Отмена удаления по записи журнала #%(id)s', id=log.id) }}"
      data-confirm-ok="{{ _('Восстановить') }}"
      data-confirm-variant="warning">
  <input type="hidden" name="next" value="{{ url_for('logs') }}">
  <button type="submit" class="btn btn-sm btn-outline-warning">
    {{ _('Отменить удаление') }}
  </button>
</form>
    {% else %}
      <span class="text-muted ms-2">
        {{ _('Невозможно отменить: нет ID записи журнала') }}
      </span>
    {% endif %}
  {% endif %}
</td>
            {# -------------------------------------------------------------------- #}
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="5" class="text-center py-4">{{ _('Записей не найдено') }}</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}