{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
  <h2>üì¶ {{ _('–£—á—ë—Ç —Ç–æ–≤–∞—Ä–æ–≤') }}</h2>
  {% if g.user.role == 'editor' %}
  <div class="d-flex gap-2 flex-wrap">
    <a href="{{ url_for('create') }}" class="btn btn-success btn-narrow">‚ûï {{ _('–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä') }}</a>
    <a href="{{ url_for('add_category') }}" class="btn btn-success btn-narrow">üìÅ {{ _('–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é') }}</a>
    <a href="{{ url_for('export_excel') }}" class="btn btn-outline-secondary btn-narrow">{{ _('–°–∫–∞—á–∞—Ç—å Excel') }}</a>
  </div>
  {% endif %}
</div>

<!-- –§–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞ -->
<form class="row g-2 mb-3" method="get" action="{{ url_for('index') }}">
  <div class="col-md-3">
    <input type="text" class="form-control" name="search" placeholder="{{ _('–ù–∞–∑–≤–∞–Ω–∏–µ...') }}" value="{{ request.args.get('search', '') }}">
  </div>
  <div class="col-md-2">
    <select name="category_id" class="form-select">
      <option value="">{{ _('–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏') }}</option>
      {% for cat in categories %}
        <option value="{{ cat.id }}" {% if request.args.get('category_id', type=int) == cat.id %}selected{% endif %}>{{ cat.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <input type="text" name="size" class="form-control" placeholder="{{ _('–†–∞–∑–º–µ—Ä') }}" value="{{ request.args.get('size', '') }}">
  </div>
  <div class="col-md-2">
    <input type="number" name="max_price" step="0.01" class="form-control" placeholder="{{ _('–¶–µ–Ω–∞ ‚â§') }}" value="{{ request.args.get('max_price', '') }}">
  </div>
  <div class="col-md-2">
    <input type="number" name="min_quantity" step="0.01" class="form-control" placeholder="{{ _('–ö–æ–ª-–≤–æ ‚â•') }}" value="{{ request.args.get('min_quantity', '') }}">
  </div>
  <div class="col-md-1">
    <button type="submit" class="btn btn-primary w-100">{{ _('–ü–æ–∏—Å–∫') }}</button>
  </div>
  <div class="col-12">
    <a href="{{ url_for('index') }}">{{ _('–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä') }}</a>
  </div>
</form>

<table class="table table-bordered align-middle table-hover mb-5">
  <thead class="table-dark">
    <tr>
      <th>{{ _('–ù–∞–∑–≤–∞–Ω–∏–µ') }}</th>
      <th>{{ _('–ö–∞—Ç–µ–≥–æ—Ä–∏—è') }}</th>
      <th>{{ _('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ') }}</th>
      <th>{{ _('–†–∞–∑–º–µ—Ä') }}</th>
      <th>{{ _('–¶–µ–Ω–∞, ‚Ç¨') }}</th>
      {% if g.user.role == 'editor' %}
      <th>{{ _('–î–µ–π—Å—Ç–≤–∏—è') }}</th>
      {% endif %}
    </tr>
  </thead>
  <tbody>
    {% for product in products %}
    <tr>
      <td>
        <a href="{{ url_for('view', product_id=product.id) }}" class="text-decoration-none d-flex align-items-center gap-2">
          {% if product.image_url %}
            <img src="{{ product.image_url }}" alt="{{ product.name }}" style="height:36px; width:auto; border-radius:6px; object-fit:cover; margin-right: 7px;">
          {% endif %}
          {{ product.name }}
        </a>
      </td>
      <td>{{ product.category_name }}</td>
      <td>{{ product.quantity }} {{ product.unit }}</td>
      <td>{{ product.size }}</td>
      <td>{% if product.price is not none %}{{ '%.2f'|format(product.price) }}{% endif %}</td>
      {% if g.user.role == 'editor' %}
      <td>
        <div class="d-flex gap-2">
          <a href="{{ url_for('edit', product_id=product.id) }}" class="btn btn-warning btn-sm btn-narrow">{{ _('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å') }}</a>
          <form action="{{ url_for('delete', product_id=product.id) }}" method="post" style="display:inline;">
            <button type="submit" class="btn btn-danger btn-sm btn-narrow" onclick="return confirm('{{ _('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?') }}')">{{ _('–£–¥–∞–ª–∏—Ç—å') }}</button>
          </form>
        </div>
      </td>
      {% endif %}
    </tr>
    {% endfor %}
  </tbody>
</table>

<div class="main-card mt-4 p-4" style="max-width: 600px; margin-left: auto; margin-right: auto;">
  <h5>üìä {{ _('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:') }}</h5>
  <ul class="list-group mb-4">
    <li class="list-group-item">{{ _('–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤:') }} <strong>{{ total_products }}</strong></li>
    <li class="list-group-item">{{ _('–í—Å–µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:') }} <strong>{{ total_categories }}</strong></li>
  </ul>

  <h5>üÜï {{ _('–ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã:') }}</h5>
  <ul class="list-group">
    {% for product in recent_products %}
    <li class="list-group-item">
      <a href="{{ url_for('view', product_id=product.id) }}" class="text-decoration-none">
        {{ product.name }} ({{ product.quantity }} {{ product.unit }})
      </a>
      ‚Äî {{ product.created_at[:16].replace('T', ' ') }}
    </li>
    {% endfor %}
  </ul>
</div>
{% endblock %}