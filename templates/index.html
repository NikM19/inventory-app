{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>üì¶ –£—á—ë—Ç —Ç–æ–≤–∞—Ä–æ–≤</h2>
    <div>
      <a href="{{ url_for('create') }}" class="btn btn-success">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</a>
      <a href="{{ url_for('add_category') }}" class="btn btn-primary">üìÅ –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</a>
    </div>
  </div>

  <form class="row g-2 mb-3" method="get">
    <div class="col-md-4">
      <input type="text" name="q" class="form-control" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é‚Ä¶" value="{{ search_query }}">
    </div>
    <div class="col-md-3">
      <select name="category_id" class="form-select">
        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
        {% for category in categories %}
        <option value="{{ category.id }}" {% if category.id == category_id %}selected{% endif %}>{{ category.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-3">
      <button type="submit" class="btn btn-dark w-100">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    </div>
  </form>

  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}
  {% endwith %}

  <table class="table table-bordered align-middle table-hover">
    <thead class="table-dark">
      <tr>
        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
        <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
    </thead>
    <tbody>
      {% for product in products %}
      <tr>
        <td>
          <a href="{{ url_for('view', product_id=product.id) }}" class="d-flex align-items-center text-decoration-none">
            {% if product.image_url %}
              <img src="{{ product.image_url }}"
                   alt="{{ product.name }}"
                   style="height: 40px; width: 40px; object-fit: cover; margin-right: 10px; border-radius: 4px;">
            {% endif %}
            {{ product.name }}
          </a>
        </td>
        <td>{{ product.category.name if product.category else '' }}</td>
        <td>{{ product.quantity }} {{ product.unit }}</td>
        <td>
          <a href="{{ url_for('view', product_id=product.id) }}" class="btn btn-info btn-sm">–ü—Ä–æ—Å–º–æ—Ç—Ä</a>
          <a href="{{ url_for('edit', product_id=product.id) }}" class="btn btn-warning btn-sm">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
          <form action="{{ url_for('delete', product_id=product.id) }}" method="post" style="display:inline;">
            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')">–£–¥–∞–ª–∏—Ç—å</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <hr>

  <h5 class="mb-3">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h5>
  <ul class="list-group mb-4">
    <li class="list-group-item">–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤: <strong>{{ total_products }}</strong></li>
    <li class="list-group-item">–í—Å–µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: <strong>{{ total_categories }}</strong></li>
  </ul>

  <h5 class="mb-3">üÜï –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã:</h5>
  <ul class="list-group">
    {% for product in recent_products %}
    <li class="list-group-item">
      <a href="{{ url_for('view', product_id=product.id) }}" class="text-decoration-none">
        {{ product.name }} ({{ product.quantity }} {{ product.unit }})
      </a>
      ‚Äî {{ product.created_at.strftime('%Y-%m-%d %H:%M') }}
    </li>
    {% endfor %}
  </ul>
</div>
{% endblock %}
