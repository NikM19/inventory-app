{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>üì¶ –£—á—ë—Ç —Ç–æ–≤–∞—Ä–æ–≤</h2>
  {% if g.user.role == 'editor' %}
  <div>
    <a href="{{ url_for('create') }}" class="btn btn-success">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</a>
    <a href="{{ url_for('add_category') }}" class="btn btn-success">üìÅ –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</a>
    <a href="{{ url_for('export_excel') }}" class="btn btn-outline-secondary">–°–∫–∞—á–∞—Ç—å Excel</a>
  </div>
  {% endif %}
</div>

<table class="table table-bordered align-middle table-hover mb-5">
  <thead class="table-dark">
    <tr>
      <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
      <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
      <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
      <th>–†–∞–∑–º–µ—Ä</th>
      <th>–¶–µ–Ω–∞, ‚Ç¨</th>
      <th>–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
  </thead>
  <tbody>
    {% for product in products %}
    <tr>
      <td>
        <a href="{{ url_for('view', product_id=product.id) }}" class="text-decoration-none d-flex align-items-center gap-2">
          {% if product.image_url %}
            <img src="{{ product.image_url }}" alt="{{ product.name }}" style="height:36px; width:auto; border-radius:6px; object-fit:cover; margin-right: 7px;">
          {% endif %}
          {{ product.name }}
        </a>
      </td>
      <td>{{ product.category_name }}</td>
      <td>{{ product.quantity }} {{ product.unit }}</td>
      <td>{{ product.size }}</td>
      <td>{% if product.price is not none %}{{ '%.2f'|format(product.price) }}{% endif %}</td>
      <td>
        {% if g.user.role == 'editor' %}
        <a href="{{ url_for('edit', product_id=product.id) }}" class="btn btn-warning btn-sm">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        <form action="{{ url_for('delete', product_id=product.id) }}" method="post" style="display:inline;">
          <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')">–£–¥–∞–ª–∏—Ç—å</button>
        </form>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- –§–∏—Ä–º–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ -->
<div class="main-card mt-4 p-4" style="max-width: 600px; margin-left: auto; margin-right: auto;">
  <h5>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h5>
  <ul class="list-group mb-4">
    <li class="list-group-item">–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤: <strong>{{ total_products }}</strong></li>
    <li class="list-group-item">–í—Å–µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: <strong>{{ total_categories }}</strong></li>
  </ul>

  <h5>üÜï –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã:</h5>
  <ul class="list-group">
    {% for product in recent_products %}
    <li class="list-group-item">
      <a href="{{ url_for('view', product_id=product.id) }}" class="text-decoration-none">
        {{ product.name }} ({{ product.quantity }} {{ product.unit }})
      </a>
      ‚Äî {{ product.created_at[:16].replace('T', ' ') }}
    </li>
    {% endfor %}
  </ul>
</div>
{% endblock %}